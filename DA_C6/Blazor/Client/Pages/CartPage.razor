@page "/cartpage"
@using Blazor.Shared.Model
@inject HttpClient httpclient
<div class="container">
	<h1>Giỏ hàng</h1>
	@*   @foreach(var item in cartItems)
	{
	@item.IDCart
	} *@
	<div class="row">
		<div class="col-md-12">
			<div class="cart-items">
				@if (cartItems != null)
				{
					@foreach (var item in cartItems.Where(u => u.UserName == "Admin"))
					{
						var prodd = productdetailitems.FirstOrDefault(pd => pd.IDPDetail == item.IDPDetail);
						if (prodd != null)
						{
							var size = sizeitems.FirstOrDefault(s => s.IDSize == prodd.Size);
							var color = coloritems.FirstOrDefault(cl => cl.IDColor == prodd.IDColor);
							var product = productitems.FirstOrDefault(p => p.IDProduct == prodd.IDProduct);
							if (product != null)
							{
								<div class="cart-item mb-3">
									<input type="checkbox" name="name" value="" class="m-3" />
									<img src="/@product.Image" alt="Sản phẩm">
									<div class="cart-item-info">
										<h5 class="cart-item-title">@product.Name</h5>
										<p>
											@if (size != null && color != null)
											{
											<p>Kích thước - màu sắc: @size.SizeName - @color.Color</p> <!-- Hiển thị thông tin kích thước -->
											}
										</p>
										<div>
											<div class="quantity-selector">
												<form>
													<button type="button" class="decrease-btn">-</button>
													<input type="text" name="quantity" value="@item.Quantity" class="quantity-input" readonly>
													<button type="button" class="increase-btn">+</button>
												</form>
											</div>
										</div>
									</div>
									<div class="">
										<a class="nav-link text-dark float-end ms-3" href="#" asp-area="" asp-controller="About" asp-action="Index">
											<img src="/IMG/about.png" alt="Cart" style="width: 24px; height: 24px;">
										</a>
										<p class="cart-item-price float-end text-black">
											@{
												var totalPrice = product.Price * item.Quantity; // Tính tổng giá sản phẩm
											}
											@totalPrice.ToString("N0")VNĐ
										</p>
									</div>
								</div>
							}
						}

					}
				}
				else
				{
					<div class="spinner-border" role="status">
						<span class="visually-hidden">Loading...</span>
					</div>
				}

			</div>
		</div>

		<div class="col-md-12">
			<div class="cart-summary">
				@*                 <h2 class="cart-total">Tổng đơn hàng: $339.98</h2>
				*@
				<a href="#" class="btn btn-danger btn-block">Xóa giỏ hàng</a>
				<a href="#" class="btn btn-success btn-dark">Thanh toán</a>
			</div>
		</div>
	</div>
	<hr>
	<div class="product-list">
		@if(productitems != null)
		{
			@foreach(var item in productitems.Take(4))
			{
				<div class="product-item">
					<a href="productdetail/@item.IDProduct">
						<img src="/@item.Image" alt="Đồng hồ">
					</a>
				
						<h5>@item.Name</h5>
						<div class="row container-fluid justify-content-center text-center">
							<p class="font-weight-bold col-sm-8 mb-1">4.5 <i class="bi bi-star-fill"></i></p>
							<p class="font-weight-bold col-sm-4 mb-1">@item.Price.ToString("N0")</p>
						</div>
				
				</div>
			}
		}
	</div>
	<nav aria-label="Page navigation example">
		<ul class="pagination">
			<li class="page-item"><a class="page-link" href="#">Previous</a></li>
			<li class="page-item"><a class="page-link" href="#">1</a></li>
			<li class="page-item"><a class="page-link" href="#">2</a></li>
			<li class="page-item"><a class="page-link" href="#">3</a></li>
			<li class="page-item"><a class="page-link" href="#">Next</a></li>
		</ul>
	</nav>
</div>



@code {
	private List<Cart> cartItems;
	private List<Product> productitems;
	private List<ProductDetails> productdetailitems;
	private List<Sizes> sizeitems;
	private List<Colors> coloritems;
	private Cart c = new Cart();
	private Product p = new Product();
	private ProductDetails pd = new ProductDetails();
	private Sizes s = new Sizes();
	private Colors cl = new Colors();

	protected override async Task OnInitializedAsync()
	{
		try
		{
			cartItems = await httpclient.GetFromJsonAsync<List<Cart>>("api/Cart/GetCarts");
			productitems = await httpclient.GetFromJsonAsync<List<Product>>("api/Product/GetProducts");
			productdetailitems = await httpclient.GetFromJsonAsync<List<ProductDetails>>("api/ProductDetail/GetProductDetails");
			sizeitems = await httpclient.GetFromJsonAsync<List<Sizes>>("api/Size/GetSizes");
			coloritems = await httpclient.GetFromJsonAsync<List<Colors>>("api/Color/GetColors");
		}
		catch (Exception ex)
		{
			Console.WriteLine($"Error: {ex.Message}");
		}
		await base.OnInitializedAsync();
	}
}
